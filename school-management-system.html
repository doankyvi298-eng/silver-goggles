<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦æ ¡å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b82f6 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><defs><linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0.05)"/></linearGradient></defs><rect width="1200" height="200" fill="url(%23skyGrad)"/><polygon points="100,200 200,150 250,170 250,200" fill="rgba(255,255,255,0.15)"/><polygon points="300,200 380,140 420,160 450,150 450,200" fill="rgba(255,255,255,0.12)"/><polygon points="500,200 600,130 650,145 700,135 750,145 750,200" fill="rgba(255,255,255,0.18)"/><polygon points="800,200 900,160 950,175 1000,165 1000,200" fill="rgba(255,255,255,0.14)"/><rect x="150" y="170" width="4" height="30" fill="rgba(255,255,255,0.2)"/><rect x="170" y="165" width="4" height="35" fill="rgba(255,255,255,0.2)"/><rect x="190" y="175" width="4" height="25" fill="rgba(255,255,255,0.2)"/><rect x="350" y="160" width="4" height="40" fill="rgba(255,255,255,0.2)"/><rect x="370" y="155" width="4" height="45" fill="rgba(255,255,255,0.2)"/><rect x="550" y="145" width="4" height="55" fill="rgba(255,255,255,0.2)"/><rect x="580" y="140" width="4" height="60" fill="rgba(255,255,255,0.2)"/><rect x="620" y="150" width="4" height="50" fill="rgba(255,255,255,0.2)"/></svg>') no-repeat;
            background-size: cover;
            opacity: 0.4;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header-icon {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            padding: 15px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
            font-size: 24px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header p {
            opacity: 0.95;
            font-size: 18px;
            font-weight: 300;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 8px;
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            border-color: #4CAF50;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; }

        .filter-select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            background: white;
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .student-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .student-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .student-id {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #4CAF50;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .schedule-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(52, 73, 94, 0.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }

        .schedule-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: center;
            flex-wrap: wrap;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            border-left: 4px solid #3498DB;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border: 1px solid rgba(52, 73, 94, 0.08);
        }

        .schedule-table th,
        .schedule-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .schedule-table th {
            background: linear-gradient(135deg, #2C3E50, #34495E);
            color: white;
            font-weight: 600;
            font-size: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            position: relative;
        }

        .schedule-table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #3498DB, #2980B9);
        }

        .schedule-table td {
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .schedule-table td:hover {
            background: #f0f8ff;
        }

        .time-slot {
            background: #e9ecef;
            font-weight: 500;
            color: #495057;
        }

        .course-cell {
            position: relative;
            min-height: 50px;
        }

        .course-item {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin: 2px 0;
            line-height: 1.2;
        }

        .course-colors {
            background: #28a745; /* è¯­æ–‡ - ç»¿è‰² */
        }

        .course-colors.math {
            background: #dc3545; /* æ•°å­¦ - çº¢è‰² */
        }

        .course-colors.english {
            background: #17a2b8; /* è‹±è¯­ - é’è‰² */
        }

        .course-colors.physics {
            background: #6610f2; /* ç‰©ç† - ç´«è‰² */
        }

        .course-colors.chemistry {
            background: #e83e8c; /* åŒ–å­¦ - ç²‰è‰² */
        }

        .course-colors.biology {
            background: #20c997; /* ç”Ÿç‰© - ç»¿æ¾çŸ³è‰² */
        }

        .course-colors.history {
            background: #fd7e14; /* å†å² - æ©™è‰² */
        }

        .course-colors.geography {
            background: #6f42c1; /* åœ°ç† - ç´«è‰² */
        }

        .course-colors.politics {
            background: #dc3545; /* æ”¿æ²» - çº¢è‰² */
        }

        .course-colors.music {
            background: #e83e8c; /* éŸ³ä¹ - ç²‰è‰² */
        }

        .course-colors.art {
            background: #fd7e14; /* ç¾æœ¯ - æ©™è‰² */
        }

        .course-colors.pe {
            background: #28a745; /* ä½“è‚² - ç»¿è‰² */
        }

        .course-colors.computer {
            background: #6c757d; /* ä¿¡æ¯æŠ€æœ¯ - ç°è‰² */
        }

        .course-colors.labor {
            background: #ffc107; /* åŠ³åŠ¨æŠ€æœ¯ - é»„è‰² */
        }

        .course-colors.moral {
            background: #17a2b8; /* é“å¾·ä¸æ³•æ²» - é’è‰² */
        }

        .course-colors.science {
            background: #6610f2; /* ç§‘å­¦ - ç´«è‰² */
        }

        .course-colors.reading {
            background: #20c997; /* é˜…è¯» - ç»¿æ¾çŸ³è‰² */
        }

        .course-colors.writing {
            background: #fd7e14; /* å†™ä½œ - æ©™è‰² */
        }

        .course-colors.mental {
            background: #e83e8c; /* å¿ƒç†å¥åº· - ç²‰è‰² */
        }

        .daily-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #3498DB, #2980B9);
            color: white;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .daily-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-selector label {
            font-weight: 600;
            color: #2C3E50;
        }

        .date-selector input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .date-selector input:focus {
            border-color: #3498DB;
        }

        .quick-date-buttons {
            display: flex;
            gap: 10px;
        }

        .date-label, .class-label {
            font-weight: 600;
            font-size: 16px;
        }

        .daily-courses {
            max-height: 400px;
            overflow-y: auto;
        }

        .daily-course-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #3498DB;
            transition: all 0.3s ease;
        }

        .daily-course-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
        }

        .course-time {
            flex: 0 0 120px;
            font-weight: 600;
            color: #2C3E50;
            background: #ECF0F1;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            margin-right: 15px;
        }

        .course-details {
            flex: 1;
        }

        .course-name {
            font-size: 18px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .course-teacher {
            font-size: 14px;
            color: #7F8C8D;
            font-style: italic;
        }

        .no-courses {
            text-align: center;
            padding: 40px 20px;
            color: #7F8C8D;
            font-size: 16px;
        }

        .no-courses-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* Excelè¡¨æ ¼æ ·å¼ */
        .excel-stats-container {
            margin: 20px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .excel-stats-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .excel-stats-title {
            font-size: 18px;
            font-weight: 600;
        }

        .excel-actions {
            display: flex;
            gap: 10px;
        }

        .excel-stats-table {
            max-height: 400px;
            overflow-y: auto;
        }

        .excel-table {
            width: 100%;
            border-collapse: collapse;
        }

        .excel-table th {
            background: #f8f9fa;
            color: #333;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .excel-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .excel-table tr:hover {
            background: #f8f9fa;
        }

        .excel-table tr:nth-child(even) {
            background: rgba(0,123,255,0.02);
        }

        .excel-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .nav-tab {
                padding: 15px 10px;
                font-size: 14px;
            }

            .tab-content {
                padding: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            .student-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .schedule-table {
                font-size: 12px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 8px 4px;
            }

            .daily-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>
                    <span class="header-icon">ğŸ¢</span>
                    æ™ºæ…§æ ¡å›­ç®¡ç†ç³»ç»Ÿ
                </h1>
                <p>åˆä¸­å­¦ç”Ÿä¿¡æ¯ç»Ÿè®¡ä¸æ™ºèƒ½è¯¾ç¨‹è¡¨ç®¡ç†å¹³å°</p>
                <div class="header-subtitle">ä¸ºç°ä»£åŒ–æ•™å­¦ç®¡ç†èµ‹èƒ½</div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('students')">ğŸ“‹ å­¦ç”Ÿä¿¡æ¯ç®¡ç†</button>
            <button class="nav-tab" onclick="switchTab('schedule')">ğŸ“… è¯¾ç¨‹è¡¨ç®¡ç†</button>
        </div>

        <!-- å­¦ç”Ÿä¿¡æ¯ç®¡ç†é¡µé¢ -->
        <div id="students" class="tab-content active">
            <h2 class="section-title">ğŸ“Š å­¦ç”Ÿä¿¡æ¯ç»Ÿè®¡</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalStudents">0</div>
                    <div class="stat-label">æ€»å­¦ç”Ÿæ•°</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF6B6B, #EE5A24);">
                    <div class="stat-number" id="gradeCount">0</div>
                    <div class="stat-label">å¹´çº§æ•°é‡</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
                    <div class="stat-number" id="classCount">0</div>
                    <div class="stat-label">ç­çº§æ•°é‡</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #45B7D1, #96C93D);">
                    <div class="stat-number" id="dormCount">0</div>
                    <div class="stat-label">å®¿èˆæ¥¼æ•°</div>
                </div>
            </div>

            <div class="controls">
                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="searchInput" placeholder="æœç´¢å­¦ç”Ÿå§“åã€ç­çº§æˆ–å®¿èˆ..." onkeyup="filterStudents()">
                </div>
                <select class="filter-select" id="gradeFilter" onchange="filterStudents()">
                    <option value="">æ‰€æœ‰å¹´çº§</option>
                </select>
                <select class="filter-select" id="classFilter" onchange="filterStudents()">
                    <option value="">æ‰€æœ‰ç­çº§</option>
                </select>
                <button class="btn btn-success" onclick="showAddStudentModal()">â• æ·»åŠ å­¦ç”Ÿ</button>
                <button class="btn btn-warning" onclick="exportToExcel()">ğŸ“¤ å¯¼å‡ºExcel</button>
                <button class="btn btn-primary" onclick="importFromExcel()">ğŸ“¥ å¯¼å…¥Excel</button>
            </div>

            <!-- Excelç»Ÿè®¡è¡¨æ ¼ -->
            <div class="excel-stats-container" id="excelStatsContainer">
                <div class="excel-stats-header">
                    <div class="excel-stats-title">ğŸ“Š å­¦ç”Ÿä¿¡æ¯ç»Ÿè®¡è¡¨</div>
                    <div class="excel-actions">
                        <button class="btn btn-sm btn-success" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                        <button class="btn btn-sm btn-primary" onclick="refreshExcelTable()">ğŸ”„ åˆ·æ–°</button>
                    </div>
                </div>
                <div class="excel-stats-table">
                    <table class="excel-table" id="excelTable">
                        <thead>
                            <tr>
                                <th>åºå·</th>
                                <th>å§“å</th>
                                <th>å¹´çº§</th>
                                <th>ç­çº§</th>
                                <th>ç”µè¯</th>
                                <th>å®¿èˆæ¥¼</th>
                                <th>å¹´é¾„</th>
                                <th>å®¶åº­ä½å€</th>
                            </tr>
                        </thead>
                        <tbody id="excelTableBody">
                            <!-- æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="student-grid" id="studentGrid">
                <!-- å­¦ç”Ÿå¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- è¯¾ç¨‹è¡¨ç®¡ç†é¡µé¢ -->
        <div id="schedule" class="tab-content">
            <h2 class="section-title">ğŸ“… è¯¾ç¨‹è¡¨ç®¡ç†</h2>

            <div class="schedule-container">
                <div class="schedule-controls">
                    <select class="filter-select" id="scheduleGrade" onchange="loadSchedule()">
                        <option value="">é€‰æ‹©å¹´çº§</option>
                    </select>
                    <select class="filter-select" id="scheduleClass" onchange="loadSchedule()">
                        <option value="">é€‰æ‹©ç­çº§</option>
                    </select>
                    <button class="btn btn-success" onclick="showAddCourseModal()">â• æ·»åŠ è¯¾ç¨‹</button>
                    <button class="btn btn-primary" onclick="generateScheduleTemplate()">ğŸ“‹ ç”Ÿæˆæ¨¡æ¿</button>
                    <button class="btn btn-warning" onclick="showDailyView()">ğŸ‘ï¸ æŸ¥çœ‹è¯¾ç¨‹</button>
                </div>

                <table class="schedule-table" id="scheduleTable">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>å‘¨ä¸€</th>
                            <th>å‘¨äºŒ</th>
                            <th>å‘¨ä¸‰</th>
                            <th>å‘¨å››</th>
                            <th>å‘¨äº”</th>
                            <th>å‘¨å…­</th>
                            <th>å‘¨æ—¥</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody">
                        <!-- è¯¾ç¨‹è¡¨å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘å­¦ç”Ÿæ¨¡æ€æ¡† -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="studentModalTitle">æ·»åŠ å­¦ç”Ÿ</h3>
                <button class="close-btn" onclick="closeModal('studentModal')">Ã—</button>
            </div>

            <form id="studentForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>å§“å *</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-group">
                        <label>å¹´é¾„</label>
                        <input type="number" id="studentAge" min="6" max="25">
                    </div>
                    <div class="form-group">
                        <label>å¹´çº§ *</label>
                        <select id="studentGrade" required>
                            <option value="">é€‰æ‹©å¹´çº§</option>
                            <option value="åˆä¸€">åˆä¸€</option>
                            <option value="åˆäºŒ">åˆäºŒ</option>
                            <option value="åˆä¸‰">åˆä¸‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç­çº§ *</label>
                        <select id="studentClass" required>
                            <option value="">é€‰æ‹©ç­çº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è”ç³»ç”µè¯</label>
                        <input type="tel" id="studentPhone">
                    </div>
                    <div class="form-group">
                        <label>å®¿èˆæ¥¼</label>
                        <select id="studentDorm">
                            <option value="">é€‰æ‹©å®¿èˆæ¥¼</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>å®¶åº­ä½å€</label>
                    <textarea id="studentAddress" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('studentModal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ·»åŠ è¯¾ç¨‹æ¨¡æ€æ¡† -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æ·»åŠ è¯¾ç¨‹</h3>
                <button class="close-btn" onclick="closeModal('courseModal')">Ã—</button>
            </div>

            <form id="courseForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>å¹´çº§ *</label>
                        <select id="courseGrade" required>
                            <option value="">é€‰æ‹©å¹´çº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç­çº§ *</label>
                        <select id="courseClass" required>
                            <option value="">é€‰æ‹©ç­çº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ˜ŸæœŸ *</label>
                        <select id="courseDay" required>
                            <option value="">é€‰æ‹©æ˜ŸæœŸ</option>
                            <option value="1">å‘¨ä¸€</option>
                            <option value="2">å‘¨äºŒ</option>
                            <option value="3">å‘¨ä¸‰</option>
                            <option value="4">å‘¨å››</option>
                            <option value="5">å‘¨äº”</option>
                            <option value="6">å‘¨å…­</option>
                            <option value="7">å‘¨æ—¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>èŠ‚æ¬¡ *</label>
                        <select id="coursePeriod" required>
                            <option value="">é€‰æ‹©èŠ‚æ¬¡</option>
                            <option value="1">ç¬¬1èŠ‚</option>
                            <option value="2">ç¬¬2èŠ‚</option>
                            <option value="3">ç¬¬3èŠ‚</option>
                            <option value="4">ç¬¬4èŠ‚</option>
                            <option value="5">ç¬¬5èŠ‚</option>
                            <option value="6">ç¬¬6èŠ‚</option>
                            <option value="7">ç¬¬7èŠ‚</option>
                            <option value="8">ç¬¬8èŠ‚</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¯¾ç¨‹åç§° *</label>
                        <select id="courseName" required>
                            <option value="">é€‰æ‹©è¯¾ç¨‹</option>
                            <!-- è¯­æ–‡ -->
                            <optgroup label="è¯­æ–‡ç±»">
                                <option value="è¯­æ–‡">è¯­æ–‡</option>
                                <option value="é˜…è¯»">é˜…è¯»</option>
                                <option value="å†™ä½œ">å†™ä½œ</option>
                            </optgroup>
                            <!-- æ•°å­¦ -->
                            <optgroup label="æ•°å­¦ç±»">
                                <option value="æ•°å­¦">æ•°å­¦</option>
                                <option value="æ•°å­¦æ€ç»´">æ•°å­¦æ€ç»´</option>
                            </optgroup>
                            <!-- è‹±è¯­ -->
                            <optgroup label="å¤–è¯­ç±»">
                                <option value="è‹±è¯­">è‹±è¯­</option>
                                <option value="è‹±è¯­å£è¯­">è‹±è¯­å£è¯­</option>
                                <option value="è‹±è¯­å¬åŠ›">è‹±è¯­å¬åŠ›</option>
                            </optgroup>
                            <!-- ç†ç§‘ -->
                            <optgroup label="ç†ç§‘ç±»">
                                <option value="ç‰©ç†">ç‰©ç†</option>
                                <option value="åŒ–å­¦">åŒ–å­¦</option>
                                <option value="ç”Ÿç‰©">ç”Ÿç‰©</option>
                                <option value="ç§‘å­¦">ç§‘å­¦</option>
                            </optgroup>
                            <!-- æ–‡ç§‘ -->
                            <optgroup label="æ–‡ç§‘ç±»">
                                <option value="å†å²">å†å²</option>
                                <option value="åœ°ç†">åœ°ç†</option>
                                <option value="é“å¾·ä¸æ³•æ²»">é“å¾·ä¸æ³•æ²»</option>
                                <option value="æ€æƒ³å“å¾·">æ€æƒ³å“å¾·</option>
                            </optgroup>
                            <!-- è‰ºæœ¯ä½“è‚² -->
                            <optgroup label="è‰ºæœ¯ä½“è‚²ç±»">
                                <option value="éŸ³ä¹">éŸ³ä¹</option>
                                <option value="ç¾æœ¯">ç¾æœ¯</option>
                                <option value="ä½“è‚²">ä½“è‚²</option>
                                <option value="ä½“è‚²ä¸å¥åº·">ä½“è‚²ä¸å¥åº·</option>
                            </optgroup>
                            <!-- æŠ€æœ¯ç±» -->
                            <optgroup label="æŠ€æœ¯å®è·µç±»">
                                <option value="ä¿¡æ¯æŠ€æœ¯">ä¿¡æ¯æŠ€æœ¯</option>
                                <option value="åŠ³åŠ¨æŠ€æœ¯">åŠ³åŠ¨æŠ€æœ¯</option>
                                <option value="é€šç”¨æŠ€æœ¯">é€šç”¨æŠ€æœ¯</option>
                                <option value="ç»¼åˆå®è·µ">ç»¼åˆå®è·µ</option>
                            </optgroup>
                            <!-- å…¶ä»– -->
                            <optgroup label="å…¶ä»–ç±»">
                                <option value="å¿ƒç†å¥åº·">å¿ƒç†å¥åº·</option>
                                <option value="ç­ä¼š">ç­ä¼š</option>
                                <option value="è‡ªä¹ ">è‡ªä¹ </option>
                                <option value="è¯¾å¤–æ´»åŠ¨">è¯¾å¤–æ´»åŠ¨</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ä»»è¯¾æ•™å¸ˆ</label>
                        <input type="text" id="courseTeacher">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('courseModal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è¯¾ç¨‹æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div id="dailyViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“… è¯¾ç¨‹å®‰æ’æŸ¥çœ‹</h3>
                <button class="close-btn" onclick="closeModal('dailyViewModal')">Ã—</button>
            </div>

            <div id="dailyViewContent">
                <div class="daily-controls">
                    <div class="date-selector">
                        <label for="selectedDate">é€‰æ‹©æ—¥æœŸï¼š</label>
                        <input type="date" id="selectedDate" onchange="updateSelectedDateView()">
                    </div>
                    <div class="quick-date-buttons">
                        <button class="btn btn-sm btn-primary" onclick="selectToday()">ä»Šå¤©</button>
                        <button class="btn btn-sm btn-success" onclick="selectTomorrow()">æ˜å¤©</button>
                        <button class="btn btn-sm btn-warning" onclick="selectThisWeek()">æœ¬å‘¨</button>
                    </div>
                </div>

                <div class="daily-info">
                    <div class="daily-date">
                        <span class="date-label">æ—¥æœŸï¼š</span>
                        <span id="currentDate"></span>
                    </div>
                    <div class="daily-class-info">
                        <span class="class-label">ç­çº§ï¼š</span>
                        <span id="selectedClassInfo"></span>
                    </div>
                </div>

                <div class="daily-courses" id="dailyCourses">
                    <!-- è¯¾ç¨‹åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeModal('dailyViewModal')">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let students = [];
        let courses = [];
        let editingStudentId = null;

        // æ—¶é—´æ®µé…ç½®
        const timeSlots = [
            '8:00-8:45',
            '8:55-9:40',
            '10:00-10:45',
            '10:55-11:40',
            '14:30-15:15',
            '15:25-16:10',
            '16:20-17:05',
            '19:00-19:45'
        ];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            generateDormOptions();
            loadData();
            updateStats();
            updateFilters();
            renderStudents();
            renderExcelTable();
            generateScheduleTemplate();
            setupStudentGradeClassLink();
            setupCourseGradeClassLink();
        };

        // ç”Ÿæˆå®¿èˆæ¥¼é€‰é¡¹
        function generateDormOptions() {
            const dormSelect = document.getElementById('studentDorm');
            const defaultOption = '<option value="">é€‰æ‹©å®¿èˆæ¥¼</option>';
            let options = defaultOption;

            for (let building = 1; building <= 6; building++) {
                for (let floor = 1; floor <= 6; floor++) {
                    for (let room = 1; room <= 6; room++) {
                        const dormNumber = `${building}æ ‹${building}-${floor}-${room}`;
                        options += `<option value="${dormNumber}">${dormNumber}</option>`;
                    }
                }
            }

            dormSelect.innerHTML = options;
        }

        // æ¸²æŸ“Excelç»Ÿè®¡è¡¨æ ¼
        function renderExcelTable() {
            const tableBody = document.getElementById('excelTableBody');
            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="excel-empty">æš‚æ— å­¦ç”Ÿæ•°æ®</td></tr>';
                return;
            }

            students.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${student.name}</td>
                    <td>${student.grade || '-'}</td>
                    <td>${student.class || '-'}</td>
                    <td>${student.phone || '-'}</td>
                    <td>${student.dorm || '-'}</td>
                    <td>${student.age || '-'}</td>
                    <td>${student.address || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // åˆ·æ–°Excelè¡¨æ ¼
        function refreshExcelTable() {
            renderExcelTable();
            updateStats();
        }

        // å¯¼å‡ºåˆ°Excel
        function exportToExcel() {
            if (students.length === 0) {
                alert('æ²¡æœ‰å­¦ç”Ÿæ•°æ®å¯ä»¥å¯¼å‡º');
                return;
            }

            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();

            // å‡†å¤‡æ•°æ®
            const data = students.map((student, index) => ({
                'åºå·': index + 1,
                'å§“å': student.name,
                'å¹´çº§': student.grade || '',
                'ç­çº§': student.class || '',
                'ç”µè¯': student.phone || '',
                'å®¿èˆæ¥¼': student.dorm || '',
                'å¹´é¾„': student.age || '',
                'å®¶åº­ä½å€': student.address || ''
            }));

            // åˆ›å»ºå·¥ä½œè¡¨
            const ws = XLSX.utils.json_to_sheet(data);

            // è®¾ç½®åˆ—å®½
            const colWidths = [
                { wch: 6 },  // åºå·
                { wch: 12 }, // å§“å
                { wch: 8 },  // å¹´çº§
                { wch: 8 },  // ç­çº§
                { wch: 15 }, // ç”µè¯
                { wch: 15 }, // å®¿èˆæ¥¼
                { wch: 6 },  // å¹´é¾„
                { wch: 30 }  // å®¶åº­ä½å€
            ];
            ws['!cols'] = colWidths;

            // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
            XLSX.utils.book_append_sheet(wb, ws, 'å­¦ç”Ÿä¿¡æ¯ç»Ÿè®¡');

            // ç”Ÿæˆæ–‡ä»¶å
            const now = new Date();
            const dateStr = now.getFullYear() + '-' +
                          String(now.getMonth() + 1).padStart(2, '0') + '-' +
                          String(now.getDate()).padStart(2, '0');
            const timeStr = String(now.getHours()).padStart(2, '0') + '-' +
                          String(now.getMinutes()).padStart(2, '0');
            const fileName = `å­¦ç”Ÿä¿¡æ¯ç»Ÿè®¡_${dateStr}_${timeStr}.xlsx`;

            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, fileName);

            alert(`Excelæ–‡ä»¶å·²å¯¼å‡ºï¼š${fileName}`);
        }

        // ä»Excelå¯¼å…¥æ•°æ®
        function importFromExcel() {
            // åˆ›å»ºæ–‡ä»¶è¾“å…¥å…ƒç´ 
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls';
            input.style.display = 'none';

            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // è¯»å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        let imported = 0;
                        let skipped = 0;

                        jsonData.forEach(row => {
                            const name = row['å§“å'] || row['name'] || '';
                            if (name && !students.find(s => s.name === name)) {
                                const newStudent = {
                                    id: Date.now() + imported,
                                    name: name,
                                    grade: row['å¹´çº§'] || row['grade'] || '',
                                    class: row['ç­çº§'] || row['class'] || '',
                                    phone: row['ç”µè¯'] || row['phone'] || '',
                                    dorm: row['å®¿èˆæ¥¼'] || row['dorm'] || '',
                                    age: row['å¹´é¾„'] || row['age'] || '',
                                    address: row['å®¶åº­ä½å€'] || row['address'] || ''
                                };
                                students.push(newStudent);
                                imported++;
                            } else {
                                skipped++;
                            }
                        });

                        saveData();
                        updateStats();
                        updateFilters();
                        renderStudents();
                        renderExcelTable();

                        alert(`å¯¼å…¥å®Œæˆï¼\næ–°å¢å­¦ç”Ÿï¼š${imported} äºº\nè·³è¿‡é‡å¤ï¼š${skipped} äºº`);
                    } catch (error) {
                        alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
                        console.error('å¯¼å…¥é”™è¯¯:', error);
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }
        function switchTab(tabName) {
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'schedule') {
                updateScheduleFilters();
                loadSchedule();
            }
        }

        // æ˜¾ç¤ºæ·»åŠ å­¦ç”Ÿæ¨¡æ€æ¡†
        function showAddStudentModal() {
            editingStudentId = null;
            document.getElementById('studentModalTitle').textContent = 'æ·»åŠ å­¦ç”Ÿ';
            document.getElementById('studentForm').reset();
            showModal('studentModal');
        }

        // æ˜¾ç¤ºç¼–è¾‘å­¦ç”Ÿæ¨¡æ€æ¡†
        function showEditStudentModal(studentId) {
            editingStudentId = studentId;
            const student = students.find(s => s.id === studentId);

            document.getElementById('studentModalTitle').textContent = 'ç¼–è¾‘å­¦ç”Ÿä¿¡æ¯';
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentAge').value = student.age;
            document.getElementById('studentGrade').value = student.grade;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentPhone').value = student.phone;
            document.getElementById('studentDorm').value = student.dorm;
            document.getElementById('studentAddress').value = student.address;

            showModal('studentModal');
        }

        // æ˜¾ç¤ºæ·»åŠ è¯¾ç¨‹æ¨¡æ€æ¡†
        function showAddCourseModal() {
            // æ›´æ–°å¹´çº§é€‰é¡¹
            const courseGradeSelect = document.getElementById('courseGrade');
            courseGradeSelect.innerHTML = '<option value="">é€‰æ‹©å¹´çº§</option>';

            ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰'].forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                courseGradeSelect.appendChild(option);
            });

            document.getElementById('courseForm').reset();
            showModal('courseModal');
        }

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // å­¦ç”Ÿè¡¨å•æäº¤
        document.getElementById('studentForm').onsubmit = function(e) {
            e.preventDefault();

            const studentData = {
                id: editingStudentId || Date.now(),
                name: document.getElementById('studentName').value,
                age: document.getElementById('studentAge').value,
                grade: document.getElementById('studentGrade').value,
                class: document.getElementById('studentClass').value,
                phone: document.getElementById('studentPhone').value,
                dorm: document.getElementById('studentDorm').value,
                address: document.getElementById('studentAddress').value
            };

            if (editingStudentId) {
                const index = students.findIndex(s => s.id === editingStudentId);
                students[index] = studentData;
            } else {
                students.push(studentData);
            }

            saveData();
            updateStats();
            updateFilters();
            renderStudents();
            renderExcelTable(); // è‡ªåŠ¨æ›´æ–°Excelè¡¨æ ¼
            closeModal('studentModal');

            alert(editingStudentId ? 'å­¦ç”Ÿä¿¡æ¯ä¿®æ”¹æˆåŠŸï¼' : 'å­¦ç”Ÿæ·»åŠ æˆåŠŸï¼');
        };

        // è¯¾ç¨‹è¡¨å•æäº¤
        document.getElementById('courseForm').onsubmit = function(e) {
            e.preventDefault();

            const courseData = {
                id: Date.now(),
                grade: document.getElementById('courseGrade').value,
                class: document.getElementById('courseClass').value,
                day: document.getElementById('courseDay').value,
                period: document.getElementById('coursePeriod').value,
                name: document.getElementById('courseName').value,
                teacher: document.getElementById('courseTeacher').value
            };

            courses.push(courseData);
            saveData();
            loadSchedule();
            closeModal('courseModal');

            alert('è¯¾ç¨‹æ·»åŠ æˆåŠŸï¼');
        };

        // è·å–è¯¾ç¨‹æ ·å¼ç±»å
        function getCourseColorClass(courseName) {
            const colorMap = {
                'è¯­æ–‡': 'course-colors',
                'é˜…è¯»': 'course-colors reading',
                'å†™ä½œ': 'course-colors writing',
                'æ•°å­¦': 'course-colors math',
                'æ•°å­¦æ€ç»´': 'course-colors math',
                'è‹±è¯­': 'course-colors english',
                'è‹±è¯­å£è¯­': 'course-colors english',
                'è‹±è¯­å¬åŠ›': 'course-colors english',
                'ç‰©ç†': 'course-colors physics',
                'åŒ–å­¦': 'course-colors chemistry',
                'ç”Ÿç‰©': 'course-colors biology',
                'ç§‘å­¦': 'course-colors science',
                'å†å²': 'course-colors history',
                'åœ°ç†': 'course-colors geography',
                'é“å¾·ä¸æ³•æ²»': 'course-colors moral',
                'æ€æƒ³å“å¾·': 'course-colors moral',
                'éŸ³ä¹': 'course-colors music',
                'ç¾æœ¯': 'course-colors art',
                'ä½“è‚²': 'course-colors pe',
                'ä½“è‚²ä¸å¥åº·': 'course-colors pe',
                'ä¿¡æ¯æŠ€æœ¯': 'course-colors computer',
                'åŠ³åŠ¨æŠ€æœ¯': 'course-colors labor',
                'é€šç”¨æŠ€æœ¯': 'course-colors labor',
                'ç»¼åˆå®è·µ': 'course-colors labor',
                'å¿ƒç†å¥åº·': 'course-colors mental',
                'ç­ä¼š': 'course-colors',
                'è‡ªä¹ ': 'course-colors',
                'è¯¾å¤–æ´»åŠ¨': 'course-colors'
            };
            return colorMap[courseName] || 'course-item';
        }

        // åˆ é™¤å­¦ç”Ÿ
        function deleteStudent(studentId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥å­¦ç”Ÿå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                students = students.filter(s => s.id !== studentId);
                saveData();
                updateStats();
                updateFilters();
                renderStudents();
                renderExcelTable(); // è‡ªåŠ¨æ›´æ–°Excelè¡¨æ ¼
                alert('å­¦ç”Ÿåˆ é™¤æˆåŠŸï¼');
            }
        }

        // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
        function renderStudents() {
            const container = document.getElementById('studentGrid');
            container.innerHTML = '';

            const filteredStudents = getFilteredStudents();

            filteredStudents.forEach(student => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-id">ID: ${student.id}</div>
                    </div>
                    <div class="student-info">
                        <div class="info-item">
                            <div class="info-label">å¹´é¾„</div>
                            <div class="info-value">${student.age || 'æœªå¡«å†™'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">å¹´çº§ç­çº§</div>
                            <div class="info-value">${student.grade} ${student.class}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">è”ç³»ç”µè¯</div>
                            <div class="info-value">${student.phone || 'æœªå¡«å†™'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">å®¿èˆæ¥¼</div>
                            <div class="info-value">${student.dorm || 'æœªå¡«å†™'}</div>
                        </div>
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <div class="info-label">å®¶åº­ä½å€</div>
                            <div class="info-value">${student.address || 'æœªå¡«å†™'}</div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="showEditStudentModal(${student.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">åˆ é™¤</button>
                    </div>
                `;
                container.appendChild(card);
            });

            if (filteredStudents.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 50px;">æš‚æ— å­¦ç”Ÿä¿¡æ¯</div>';
            }
        }

        // è·å–è¿‡æ»¤åçš„å­¦ç”Ÿåˆ—è¡¨
        function getFilteredStudents() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const gradeFilter = document.getElementById('gradeFilter').value;
            const classFilter = document.getElementById('classFilter').value;

            return students.filter(student => {
                const matchSearch = !search ||
                    student.name.toLowerCase().includes(search) ||
                    (student.class && student.class.toLowerCase().includes(search)) ||
                    (student.dorm && student.dorm.toLowerCase().includes(search));

                const matchGrade = !gradeFilter || student.grade === gradeFilter;
                const matchClass = !classFilter || student.class === classFilter;

                return matchSearch && matchGrade && matchClass;
            });
        }

        // ç­›é€‰å­¦ç”Ÿ
        function filterStudents() {
            renderStudents();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalStudents').textContent = students.length;

            const grades = [...new Set(students.map(s => s.grade).filter(g => g))];
            document.getElementById('gradeCount').textContent = grades.length;

            const classes = [...new Set(students.map(s => `${s.grade}-${s.class}`).filter(c => c !== '-'))];
            document.getElementById('classCount').textContent = classes.length;

            const dorms = [...new Set(students.map(s => s.dorm).filter(d => d))];
            document.getElementById('dormCount').textContent = dorms.length;
        }

        // ç”Ÿæˆç­çº§é€‰é¡¹
        function generateClassOptions(gradeValue) {
            const classes = [];
            for (let i = 1; i <= 9; i++) {
                classes.push(`${i}ç­`);
            }
            return classes;
        }

        // è®¾ç½®å­¦ç”Ÿè¡¨å•çš„å¹´çº§ç­çº§è”åŠ¨
        function setupStudentGradeClassLink() {
            const gradeSelect = document.getElementById('studentGrade');
            const classSelect = document.getElementById('studentClass');

            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">é€‰æ‹©ç­çº§</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // æ›´æ–°ç­›é€‰å™¨
        function updateFilters() {
            const gradeSelect = document.getElementById('gradeFilter');
            const classSelect = document.getElementById('classFilter');

            // æ›´æ–°å¹´çº§ç­›é€‰å™¨
            const currentGrade = gradeSelect.value;
            gradeSelect.innerHTML = '<option value="">æ‰€æœ‰å¹´çº§</option>';

            const grades = [...new Set(students.map(s => s.grade).filter(g => g))];
            grades.forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                if (grade === currentGrade) option.selected = true;
                gradeSelect.appendChild(option);
            });

            // æ›´æ–°ç­çº§ç­›é€‰å™¨
            const currentClass = classSelect.value;
            classSelect.innerHTML = '<option value="">æ‰€æœ‰ç­çº§</option>';

            const classes = [...new Set(students.map(s => s.class).filter(c => c))];
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                if (cls === currentClass) option.selected = true;
                classSelect.appendChild(option);
            });
        }

        // æ›´æ–°è¯¾ç¨‹è¡¨ç­›é€‰å™¨
        function updateScheduleFilters() {
            const gradeSelect = document.getElementById('scheduleGrade');
            const classSelect = document.getElementById('scheduleClass');

            // æ›´æ–°å¹´çº§ç­›é€‰å™¨
            gradeSelect.innerHTML = '<option value="">é€‰æ‹©å¹´çº§</option>';
            ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰'].forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                gradeSelect.appendChild(option);
            });

            // æ›´æ–°ç­çº§ç­›é€‰å™¨
            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">é€‰æ‹©ç­çº§</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // è®¾ç½®è¯¾ç¨‹è¡¨å•çš„å¹´çº§ç­çº§è”åŠ¨
        function setupCourseGradeClassLink() {
            const gradeSelect = document.getElementById('courseGrade');
            const classSelect = document.getElementById('courseClass');

            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">é€‰æ‹©ç­çº§</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // ç”Ÿæˆè¯¾ç¨‹è¡¨æ¨¡æ¿
        function generateScheduleTemplate() {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';

            timeSlots.forEach((time, index) => {
                const row = document.createElement('tr');

                // æ—¶é—´åˆ—
                const timeCell = document.createElement('td');
                timeCell.className = 'time-slot';
                timeCell.textContent = `ç¬¬${index + 1}èŠ‚\n${time}`;
                row.appendChild(timeCell);

                // å‘¨ä¸€åˆ°å‘¨æ—¥
                for (let day = 1; day <= 7; day++) {
                    const cell = document.createElement('td');
                    cell.className = 'course-cell';
                    cell.setAttribute('data-day', day);
                    cell.setAttribute('data-period', index + 1);
                    cell.onclick = () => editCourseCell(day, index + 1);
                    row.appendChild(cell);
                }

                tbody.appendChild(row);
            });
        }

        // åŠ è½½è¯¾ç¨‹è¡¨
        function loadSchedule() {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                generateScheduleTemplate();
                return;
            }

            generateScheduleTemplate();

            // å¡«å…¥è¯¾ç¨‹
            courses.forEach(course => {
                if (course.grade === grade && course.class === cls) {
                    const cell = document.querySelector(`[data-day="${course.day}"][data-period="${course.period}"]`);
                    if (cell) {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = `course-item ${getCourseColorClass(course.name)}`;
                        courseDiv.innerHTML = `${course.name}<br><small>${course.teacher || ''}</small>`;
                        courseDiv.title = `${course.name}${course.teacher ? ' - ' + course.teacher : ''}`;
                        courseDiv.onclick = (e) => {
                            e.stopPropagation();
                            if (confirm(`åˆ é™¤è¯¾ç¨‹ï¼š${course.name}ï¼Ÿ`)) {
                                courses = courses.filter(c => c.id !== course.id);
                                saveData();
                                loadSchedule();
                            }
                        };
                        cell.appendChild(courseDiv);
                    }
                }
            });
        }

        // ç¼–è¾‘è¯¾ç¨‹å•å…ƒæ ¼
        function editCourseCell(day, period) {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                alert('è¯·å…ˆé€‰æ‹©å¹´çº§å’Œç­çº§');
                return;
            }

            // é¢„å¡«è¡¨å•
            document.getElementById('courseGrade').value = grade;
            document.getElementById('courseClass').value = cls;
            document.getElementById('courseDay').value = day;
            document.getElementById('coursePeriod').value = period;

            showAddCourseModal();
        }

        // é€‰æ‹©ä»Šå¤©
        function selectToday() {
            const today = new Date();
            document.getElementById('selectedDate').value = today.toISOString().split('T')[0];
            updateSelectedDateView();
        }

        // é€‰æ‹©æ˜å¤©
        function selectTomorrow() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('selectedDate').value = tomorrow.toISOString().split('T')[0];
            updateSelectedDateView();
        }

        // é€‰æ‹©æœ¬å‘¨
        function selectThisWeek() {
            selectToday(); // é»˜è®¤é€‰æ‹©ä»Šå¤©ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ—¥æœŸé€‰æ‹©å™¨è°ƒæ•´
        }

        // æ›´æ–°é€‰å®šæ—¥æœŸçš„è¯¾ç¨‹è§†å›¾
        function updateSelectedDateView() {
            const selectedDateInput = document.getElementById('selectedDate');
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!selectedDateInput.value || !grade || !cls) {
                return;
            }

            const selectedDate = new Date(selectedDateInput.value);
            const dayOfWeek = selectedDate.getDay(); // 0=Sunday, 1=Monday, ..., 6=Saturday

            // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
            const currentDate = selectedDate.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            document.getElementById('currentDate').textContent = currentDate;
            document.getElementById('selectedClassInfo').textContent = `${grade} ${cls}`;

            // è·å–é€‰å®šæ—¥æœŸçš„è¯¾ç¨‹
            const selectedDateCourses = getTodayCourses(grade, cls, dayOfWeek);
            renderDailyCourses(selectedDateCourses);
        }

        // æ˜¾ç¤ºä»Šæ—¥è¯¾ç¨‹æŸ¥çœ‹
        function showDailyView() {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                alert('è¯·å…ˆé€‰æ‹©å¹´çº§å’Œç­çº§');
                return;
            }

            // è®¾ç½®é»˜è®¤ä¸ºä»Šå¤©
            selectToday();

            showModal('dailyViewModal');
        }

        // è·å–ä»Šæ—¥è¯¾ç¨‹
        function getTodayCourses(grade, cls, dayOfWeek) {
            // å°†JavaScriptçš„æ˜ŸæœŸè½¬æ¢ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„æ ¼å¼
            // JavaScript: 0=Sunday, 1=Monday, ..., 6=Saturday
            // æˆ‘ä»¬çš„ç³»ç»Ÿ: 1=Monday, ..., 7=Sunday
            let systemDay = dayOfWeek === 0 ? 7 : dayOfWeek;

            return courses.filter(course =>
                course.grade === grade &&
                course.class === cls &&
                parseInt(course.day) === systemDay
            ).sort((a, b) => parseInt(a.period) - parseInt(b.period));
        }

        // æ¸²æŸ“ä»Šæ—¥è¯¾ç¨‹
        function renderDailyCourses(todayCourses) {
            const container = document.getElementById('dailyCourses');
            container.innerHTML = '';

            if (todayCourses.length === 0) {
                container.innerHTML = `
                    <div class="no-courses">
                        <span class="no-courses-icon">ğŸ“š</span>
                        <div>ä»Šæ—¥æš‚æ— è¯¾ç¨‹å®‰æ’</div>
                    </div>
                `;
                return;
            }

            todayCourses.forEach(course => {
                const courseItem = document.createElement('div');
                courseItem.className = 'daily-course-item';

                const timeSlot = timeSlots[parseInt(course.period) - 1] || 'æ—¶é—´å¾…å®š';

                courseItem.innerHTML = `
                    <div class="course-time">
                        ç¬¬${course.period}èŠ‚<br>
                        <small>${timeSlot}</small>
                    </div>
                    <div class="course-details">
                        <div class="course-name">${course.name}</div>
                        ${course.teacher ? `<div class="course-teacher">ä»»è¯¾æ•™å¸ˆ: ${course.teacher}</div>` : ''}
                    </div>
                `;

                // æ·»åŠ è¯¾ç¨‹é¢œè‰²æ ·å¼
                const colorClass = getCourseColorClass(course.name);
                if (colorClass !== 'course-item') {
                    courseItem.style.borderLeftColor = getComputedStyle(document.createElement('div')).getPropertyValue('background-color') || '#3498DB';
                }

                container.appendChild(courseItem);
            });
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem('school_students', JSON.stringify(students));
            localStorage.setItem('school_courses', JSON.stringify(courses));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadData() {
            const savedStudents = localStorage.getItem('school_students');
            const savedCourses = localStorage.getItem('school_courses');

            if (savedStudents) {
                students = JSON.parse(savedStudents);
            }

            if (savedCourses) {
                courses = JSON.parse(savedCourses);
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        };
    </script>
</body>
</html>