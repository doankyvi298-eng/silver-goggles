<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学校学生管理系统</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b82f6 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><defs><linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0.05)"/></linearGradient></defs><rect width="1200" height="200" fill="url(%23skyGrad)"/><polygon points="100,200 200,150 250,170 250,200" fill="rgba(255,255,255,0.15)"/><polygon points="300,200 380,140 420,160 450,150 450,200" fill="rgba(255,255,255,0.12)"/><polygon points="500,200 600,130 650,145 700,135 750,145 750,200" fill="rgba(255,255,255,0.18)"/><polygon points="800,200 900,160 950,175 1000,165 1000,200" fill="rgba(255,255,255,0.14)"/><rect x="150" y="170" width="4" height="30" fill="rgba(255,255,255,0.2)"/><rect x="170" y="165" width="4" height="35" fill="rgba(255,255,255,0.2)"/><rect x="190" y="175" width="4" height="25" fill="rgba(255,255,255,0.2)"/><rect x="350" y="160" width="4" height="40" fill="rgba(255,255,255,0.2)"/><rect x="370" y="155" width="4" height="45" fill="rgba(255,255,255,0.2)"/><rect x="550" y="145" width="4" height="55" fill="rgba(255,255,255,0.2)"/><rect x="580" y="140" width="4" height="60" fill="rgba(255,255,255,0.2)"/><rect x="620" y="150" width="4" height="50" fill="rgba(255,255,255,0.2)"/></svg>') no-repeat;
            background-size: cover;
            opacity: 0.4;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header-icon {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            padding: 15px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
            font-size: 24px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header p {
            opacity: 0.95;
            font-size: 18px;
            font-weight: 300;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 8px;
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            border-color: #4CAF50;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; }

        .filter-select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            background: white;
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .student-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .student-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .student-id {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #4CAF50;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .schedule-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(52, 73, 94, 0.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }

        .schedule-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: center;
            flex-wrap: wrap;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            border-left: 4px solid #3498DB;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border: 1px solid rgba(52, 73, 94, 0.08);
        }

        .schedule-table th,
        .schedule-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .schedule-table th {
            background: linear-gradient(135deg, #2C3E50, #34495E);
            color: white;
            font-weight: 600;
            font-size: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            position: relative;
        }

        .schedule-table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #3498DB, #2980B9);
        }

        .schedule-table td {
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .schedule-table td:hover {
            background: #f0f8ff;
        }

        .time-slot {
            background: #e9ecef;
            font-weight: 500;
            color: #495057;
        }

        .course-cell {
            position: relative;
            min-height: 50px;
        }

        .course-item {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin: 2px 0;
            line-height: 1.2;
        }

        .course-colors {
            background: #28a745; /* 语文 - 绿色 */
        }

        .course-colors.math {
            background: #dc3545; /* 数学 - 红色 */
        }

        .course-colors.english {
            background: #17a2b8; /* 英语 - 青色 */
        }

        .course-colors.physics {
            background: #6610f2; /* 物理 - 紫色 */
        }

        .course-colors.chemistry {
            background: #e83e8c; /* 化学 - 粉色 */
        }

        .course-colors.biology {
            background: #20c997; /* 生物 - 绿松石色 */
        }

        .course-colors.history {
            background: #fd7e14; /* 历史 - 橙色 */
        }

        .course-colors.geography {
            background: #6f42c1; /* 地理 - 紫色 */
        }

        .course-colors.politics {
            background: #dc3545; /* 政治 - 红色 */
        }

        .course-colors.music {
            background: #e83e8c; /* 音乐 - 粉色 */
        }

        .course-colors.art {
            background: #fd7e14; /* 美术 - 橙色 */
        }

        .course-colors.pe {
            background: #28a745; /* 体育 - 绿色 */
        }

        .course-colors.computer {
            background: #6c757d; /* 信息技术 - 灰色 */
        }

        .course-colors.labor {
            background: #ffc107; /* 劳动技术 - 黄色 */
        }

        .course-colors.moral {
            background: #17a2b8; /* 道德与法治 - 青色 */
        }

        .course-colors.science {
            background: #6610f2; /* 科学 - 紫色 */
        }

        .course-colors.reading {
            background: #20c997; /* 阅读 - 绿松石色 */
        }

        .course-colors.writing {
            background: #fd7e14; /* 写作 - 橙色 */
        }

        .course-colors.mental {
            background: #e83e8c; /* 心理健康 - 粉色 */
        }

        .daily-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #3498DB, #2980B9);
            color: white;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .daily-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-selector label {
            font-weight: 600;
            color: #2C3E50;
        }

        .date-selector input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .date-selector input:focus {
            border-color: #3498DB;
        }

        .quick-date-buttons {
            display: flex;
            gap: 10px;
        }

        .date-label, .class-label {
            font-weight: 600;
            font-size: 16px;
        }

        .daily-courses {
            max-height: 400px;
            overflow-y: auto;
        }

        .daily-course-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #3498DB;
            transition: all 0.3s ease;
        }

        .daily-course-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
        }

        .course-time {
            flex: 0 0 120px;
            font-weight: 600;
            color: #2C3E50;
            background: #ECF0F1;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            margin-right: 15px;
        }

        .course-details {
            flex: 1;
        }

        .course-name {
            font-size: 18px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .course-teacher {
            font-size: 14px;
            color: #7F8C8D;
            font-style: italic;
        }

        .no-courses {
            text-align: center;
            padding: 40px 20px;
            color: #7F8C8D;
            font-size: 16px;
        }

        .no-courses-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* Excel表格样式 */
        .excel-stats-container {
            margin: 20px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .excel-stats-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .excel-stats-title {
            font-size: 18px;
            font-weight: 600;
        }

        .excel-actions {
            display: flex;
            gap: 10px;
        }

        .excel-stats-table {
            max-height: 400px;
            overflow-y: auto;
        }

        .excel-table {
            width: 100%;
            border-collapse: collapse;
        }

        .excel-table th {
            background: #f8f9fa;
            color: #333;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .excel-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .excel-table tr:hover {
            background: #f8f9fa;
        }

        .excel-table tr:nth-child(even) {
            background: rgba(0,123,255,0.02);
        }

        .excel-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .nav-tab {
                padding: 15px 10px;
                font-size: 14px;
            }

            .tab-content {
                padding: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            .student-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .schedule-table {
                font-size: 12px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 8px 4px;
            }

            .daily-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>
                    <span class="header-icon">🏢</span>
                    智慧校园管理系统
                </h1>
                <p>初中学生信息统计与智能课程表管理平台</p>
                <div class="header-subtitle">为现代化教学管理赋能</div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('students')">📋 学生信息管理</button>
            <button class="nav-tab" onclick="switchTab('schedule')">📅 课程表管理</button>
        </div>

        <!-- 学生信息管理页面 -->
        <div id="students" class="tab-content active">
            <h2 class="section-title">📊 学生信息统计</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalStudents">0</div>
                    <div class="stat-label">总学生数</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF6B6B, #EE5A24);">
                    <div class="stat-number" id="gradeCount">0</div>
                    <div class="stat-label">年级数量</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
                    <div class="stat-number" id="classCount">0</div>
                    <div class="stat-label">班级数量</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #45B7D1, #96C93D);">
                    <div class="stat-number" id="dormCount">0</div>
                    <div class="stat-label">宿舍楼数</div>
                </div>
            </div>

            <div class="controls">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="搜索学生姓名、班级或宿舍..." onkeyup="filterStudents()">
                </div>
                <select class="filter-select" id="gradeFilter" onchange="filterStudents()">
                    <option value="">所有年级</option>
                </select>
                <select class="filter-select" id="classFilter" onchange="filterStudents()">
                    <option value="">所有班级</option>
                </select>
                <button class="btn btn-success" onclick="showAddStudentModal()">➕ 添加学生</button>
                <button class="btn btn-warning" onclick="exportToExcel()">📤 导出Excel</button>
                <button class="btn btn-primary" onclick="importFromExcel()">📥 导入Excel</button>
            </div>

            <!-- Excel统计表格 -->
            <div class="excel-stats-container" id="excelStatsContainer">
                <div class="excel-stats-header">
                    <div class="excel-stats-title">📊 学生信息统计表</div>
                    <div class="excel-actions">
                        <button class="btn btn-sm btn-success" onclick="exportToExcel()">📊 导出Excel</button>
                        <button class="btn btn-sm btn-primary" onclick="refreshExcelTable()">🔄 刷新</button>
                    </div>
                </div>
                <div class="excel-stats-table">
                    <table class="excel-table" id="excelTable">
                        <thead>
                            <tr>
                                <th>序号</th>
                                <th>姓名</th>
                                <th>年级</th>
                                <th>班级</th>
                                <th>电话</th>
                                <th>宿舍楼</th>
                                <th>年龄</th>
                                <th>家庭住址</th>
                            </tr>
                        </thead>
                        <tbody id="excelTableBody">
                            <!-- 数据将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="student-grid" id="studentGrid">
                <!-- 学生卡片将在这里动态生成 -->
            </div>
        </div>

        <!-- 课程表管理页面 -->
        <div id="schedule" class="tab-content">
            <h2 class="section-title">📅 课程表管理</h2>

            <div class="schedule-container">
                <div class="schedule-controls">
                    <select class="filter-select" id="scheduleGrade" onchange="loadSchedule()">
                        <option value="">选择年级</option>
                    </select>
                    <select class="filter-select" id="scheduleClass" onchange="loadSchedule()">
                        <option value="">选择班级</option>
                    </select>
                    <button class="btn btn-success" onclick="showAddCourseModal()">➕ 添加课程</button>
                    <button class="btn btn-primary" onclick="generateScheduleTemplate()">📋 生成模板</button>
                    <button class="btn btn-warning" onclick="showDailyView()">👁️ 查看课程</button>
                </div>

                <table class="schedule-table" id="scheduleTable">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>周一</th>
                            <th>周二</th>
                            <th>周三</th>
                            <th>周四</th>
                            <th>周五</th>
                            <th>周六</th>
                            <th>周日</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody">
                        <!-- 课程表内容将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 添加/编辑学生模态框 -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="studentModalTitle">添加学生</h3>
                <button class="close-btn" onclick="closeModal('studentModal')">×</button>
            </div>

            <form id="studentForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>姓名 *</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-group">
                        <label>年龄</label>
                        <input type="number" id="studentAge" min="6" max="25">
                    </div>
                    <div class="form-group">
                        <label>年级 *</label>
                        <select id="studentGrade" required>
                            <option value="">选择年级</option>
                            <option value="初一">初一</option>
                            <option value="初二">初二</option>
                            <option value="初三">初三</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>班级 *</label>
                        <select id="studentClass" required>
                            <option value="">选择班级</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>联系电话</label>
                        <input type="tel" id="studentPhone">
                    </div>
                    <div class="form-group">
                        <label>宿舍楼</label>
                        <select id="studentDorm">
                            <option value="">选择宿舍楼</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>家庭住址</label>
                    <textarea id="studentAddress" placeholder="请输入详细地址"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('studentModal')">取消</button>
                    <button type="submit" class="btn btn-success">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加课程模态框 -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">添加课程</h3>
                <button class="close-btn" onclick="closeModal('courseModal')">×</button>
            </div>

            <form id="courseForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>年级 *</label>
                        <select id="courseGrade" required>
                            <option value="">选择年级</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>班级 *</label>
                        <select id="courseClass" required>
                            <option value="">选择班级</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>星期 *</label>
                        <select id="courseDay" required>
                            <option value="">选择星期</option>
                            <option value="1">周一</option>
                            <option value="2">周二</option>
                            <option value="3">周三</option>
                            <option value="4">周四</option>
                            <option value="5">周五</option>
                            <option value="6">周六</option>
                            <option value="7">周日</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>节次 *</label>
                        <select id="coursePeriod" required>
                            <option value="">选择节次</option>
                            <option value="1">第1节</option>
                            <option value="2">第2节</option>
                            <option value="3">第3节</option>
                            <option value="4">第4节</option>
                            <option value="5">第5节</option>
                            <option value="6">第6节</option>
                            <option value="7">第7节</option>
                            <option value="8">第8节</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>课程名称 *</label>
                        <select id="courseName" required>
                            <option value="">选择课程</option>
                            <!-- 语文 -->
                            <optgroup label="语文类">
                                <option value="语文">语文</option>
                                <option value="阅读">阅读</option>
                                <option value="写作">写作</option>
                            </optgroup>
                            <!-- 数学 -->
                            <optgroup label="数学类">
                                <option value="数学">数学</option>
                                <option value="数学思维">数学思维</option>
                            </optgroup>
                            <!-- 英语 -->
                            <optgroup label="外语类">
                                <option value="英语">英语</option>
                                <option value="英语口语">英语口语</option>
                                <option value="英语听力">英语听力</option>
                            </optgroup>
                            <!-- 理科 -->
                            <optgroup label="理科类">
                                <option value="物理">物理</option>
                                <option value="化学">化学</option>
                                <option value="生物">生物</option>
                                <option value="科学">科学</option>
                            </optgroup>
                            <!-- 文科 -->
                            <optgroup label="文科类">
                                <option value="历史">历史</option>
                                <option value="地理">地理</option>
                                <option value="道德与法治">道德与法治</option>
                                <option value="思想品德">思想品德</option>
                            </optgroup>
                            <!-- 艺术体育 -->
                            <optgroup label="艺术体育类">
                                <option value="音乐">音乐</option>
                                <option value="美术">美术</option>
                                <option value="体育">体育</option>
                                <option value="体育与健康">体育与健康</option>
                            </optgroup>
                            <!-- 技术类 -->
                            <optgroup label="技术实践类">
                                <option value="信息技术">信息技术</option>
                                <option value="劳动技术">劳动技术</option>
                                <option value="通用技术">通用技术</option>
                                <option value="综合实践">综合实践</option>
                            </optgroup>
                            <!-- 其他 -->
                            <optgroup label="其他类">
                                <option value="心理健康">心理健康</option>
                                <option value="班会">班会</option>
                                <option value="自习">自习</option>
                                <option value="课外活动">课外活动</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>任课教师</label>
                        <input type="text" id="courseTeacher">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('courseModal')">取消</button>
                    <button type="submit" class="btn btn-success">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 课程查看模态框 -->
    <div id="dailyViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">📅 课程安排查看</h3>
                <button class="close-btn" onclick="closeModal('dailyViewModal')">×</button>
            </div>

            <div id="dailyViewContent">
                <div class="daily-controls">
                    <div class="date-selector">
                        <label for="selectedDate">选择日期：</label>
                        <input type="date" id="selectedDate" onchange="updateSelectedDateView()">
                    </div>
                    <div class="quick-date-buttons">
                        <button class="btn btn-sm btn-primary" onclick="selectToday()">今天</button>
                        <button class="btn btn-sm btn-success" onclick="selectTomorrow()">明天</button>
                        <button class="btn btn-sm btn-warning" onclick="selectThisWeek()">本周</button>
                    </div>
                </div>

                <div class="daily-info">
                    <div class="daily-date">
                        <span class="date-label">日期：</span>
                        <span id="currentDate"></span>
                    </div>
                    <div class="daily-class-info">
                        <span class="class-label">班级：</span>
                        <span id="selectedClassInfo"></span>
                    </div>
                </div>

                <div class="daily-courses" id="dailyCourses">
                    <!-- 课程列表将在这里显示 -->
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeModal('dailyViewModal')">关闭</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let students = [];
        let courses = [];
        let editingStudentId = null;

        // 时间段配置
        const timeSlots = [
            '8:00-8:45',
            '8:55-9:40',
            '10:00-10:45',
            '10:55-11:40',
            '14:30-15:15',
            '15:25-16:10',
            '16:20-17:05',
            '19:00-19:45'
        ];

        // 页面加载时初始化
        window.onload = function() {
            generateDormOptions();
            loadData();
            updateStats();
            updateFilters();
            renderStudents();
            renderExcelTable();
            generateScheduleTemplate();
            setupStudentGradeClassLink();
            setupCourseGradeClassLink();
        };

        // 生成宿舍楼选项
        function generateDormOptions() {
            const dormSelect = document.getElementById('studentDorm');
            const defaultOption = '<option value="">选择宿舍楼</option>';
            let options = defaultOption;

            for (let building = 1; building <= 6; building++) {
                for (let floor = 1; floor <= 6; floor++) {
                    for (let room = 1; room <= 6; room++) {
                        const dormNumber = `${building}栋${building}-${floor}-${room}`;
                        options += `<option value="${dormNumber}">${dormNumber}</option>`;
                    }
                }
            }

            dormSelect.innerHTML = options;
        }

        // 渲染Excel统计表格
        function renderExcelTable() {
            const tableBody = document.getElementById('excelTableBody');
            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="excel-empty">暂无学生数据</td></tr>';
                return;
            }

            students.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${student.name}</td>
                    <td>${student.grade || '-'}</td>
                    <td>${student.class || '-'}</td>
                    <td>${student.phone || '-'}</td>
                    <td>${student.dorm || '-'}</td>
                    <td>${student.age || '-'}</td>
                    <td>${student.address || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 刷新Excel表格
        function refreshExcelTable() {
            renderExcelTable();
            updateStats();
        }

        // 导出到Excel
        function exportToExcel() {
            if (students.length === 0) {
                alert('没有学生数据可以导出');
                return;
            }

            // 创建工作簿
            const wb = XLSX.utils.book_new();

            // 准备数据
            const data = students.map((student, index) => ({
                '序号': index + 1,
                '姓名': student.name,
                '年级': student.grade || '',
                '班级': student.class || '',
                '电话': student.phone || '',
                '宿舍楼': student.dorm || '',
                '年龄': student.age || '',
                '家庭住址': student.address || ''
            }));

            // 创建工作表
            const ws = XLSX.utils.json_to_sheet(data);

            // 设置列宽
            const colWidths = [
                { wch: 6 },  // 序号
                { wch: 12 }, // 姓名
                { wch: 8 },  // 年级
                { wch: 8 },  // 班级
                { wch: 15 }, // 电话
                { wch: 15 }, // 宿舍楼
                { wch: 6 },  // 年龄
                { wch: 30 }  // 家庭住址
            ];
            ws['!cols'] = colWidths;

            // 添加工作表到工作簿
            XLSX.utils.book_append_sheet(wb, ws, '学生信息统计');

            // 生成文件名
            const now = new Date();
            const dateStr = now.getFullYear() + '-' +
                          String(now.getMonth() + 1).padStart(2, '0') + '-' +
                          String(now.getDate()).padStart(2, '0');
            const timeStr = String(now.getHours()).padStart(2, '0') + '-' +
                          String(now.getMinutes()).padStart(2, '0');
            const fileName = `学生信息统计_${dateStr}_${timeStr}.xlsx`;

            // 导出文件
            XLSX.writeFile(wb, fileName);

            alert(`Excel文件已导出：${fileName}`);
        }

        // 从Excel导入数据
        function importFromExcel() {
            // 创建文件输入元素
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls';
            input.style.display = 'none';

            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // 读取第一个工作表
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        let imported = 0;
                        let skipped = 0;

                        jsonData.forEach(row => {
                            const name = row['姓名'] || row['name'] || '';
                            if (name && !students.find(s => s.name === name)) {
                                const newStudent = {
                                    id: Date.now() + imported,
                                    name: name,
                                    grade: row['年级'] || row['grade'] || '',
                                    class: row['班级'] || row['class'] || '',
                                    phone: row['电话'] || row['phone'] || '',
                                    dorm: row['宿舍楼'] || row['dorm'] || '',
                                    age: row['年龄'] || row['age'] || '',
                                    address: row['家庭住址'] || row['address'] || ''
                                };
                                students.push(newStudent);
                                imported++;
                            } else {
                                skipped++;
                            }
                        });

                        saveData();
                        updateStats();
                        updateFilters();
                        renderStudents();
                        renderExcelTable();

                        alert(`导入完成！\n新增学生：${imported} 人\n跳过重复：${skipped} 人`);
                    } catch (error) {
                        alert('文件读取失败，请检查Excel文件格式是否正确');
                        console.error('导入错误:', error);
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }
        function switchTab(tabName) {
            // 切换按钮状态
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // 切换内容
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'schedule') {
                updateScheduleFilters();
                loadSchedule();
            }
        }

        // 显示添加学生模态框
        function showAddStudentModal() {
            editingStudentId = null;
            document.getElementById('studentModalTitle').textContent = '添加学生';
            document.getElementById('studentForm').reset();
            showModal('studentModal');
        }

        // 显示编辑学生模态框
        function showEditStudentModal(studentId) {
            editingStudentId = studentId;
            const student = students.find(s => s.id === studentId);

            document.getElementById('studentModalTitle').textContent = '编辑学生信息';
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentAge').value = student.age;
            document.getElementById('studentGrade').value = student.grade;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentPhone').value = student.phone;
            document.getElementById('studentDorm').value = student.dorm;
            document.getElementById('studentAddress').value = student.address;

            showModal('studentModal');
        }

        // 显示添加课程模态框
        function showAddCourseModal() {
            // 更新年级选项
            const courseGradeSelect = document.getElementById('courseGrade');
            courseGradeSelect.innerHTML = '<option value="">选择年级</option>';

            ['初一', '初二', '初三'].forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                courseGradeSelect.appendChild(option);
            });

            document.getElementById('courseForm').reset();
            showModal('courseModal');
        }

        // 显示模态框
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // 学生表单提交
        document.getElementById('studentForm').onsubmit = function(e) {
            e.preventDefault();

            const studentData = {
                id: editingStudentId || Date.now(),
                name: document.getElementById('studentName').value,
                age: document.getElementById('studentAge').value,
                grade: document.getElementById('studentGrade').value,
                class: document.getElementById('studentClass').value,
                phone: document.getElementById('studentPhone').value,
                dorm: document.getElementById('studentDorm').value,
                address: document.getElementById('studentAddress').value
            };

            if (editingStudentId) {
                const index = students.findIndex(s => s.id === editingStudentId);
                students[index] = studentData;
            } else {
                students.push(studentData);
            }

            saveData();
            updateStats();
            updateFilters();
            renderStudents();
            renderExcelTable(); // 自动更新Excel表格
            closeModal('studentModal');

            alert(editingStudentId ? '学生信息修改成功！' : '学生添加成功！');
        };

        // 课程表单提交
        document.getElementById('courseForm').onsubmit = function(e) {
            e.preventDefault();

            const courseData = {
                id: Date.now(),
                grade: document.getElementById('courseGrade').value,
                class: document.getElementById('courseClass').value,
                day: document.getElementById('courseDay').value,
                period: document.getElementById('coursePeriod').value,
                name: document.getElementById('courseName').value,
                teacher: document.getElementById('courseTeacher').value
            };

            courses.push(courseData);
            saveData();
            loadSchedule();
            closeModal('courseModal');

            alert('课程添加成功！');
        };

        // 获取课程样式类名
        function getCourseColorClass(courseName) {
            const colorMap = {
                '语文': 'course-colors',
                '阅读': 'course-colors reading',
                '写作': 'course-colors writing',
                '数学': 'course-colors math',
                '数学思维': 'course-colors math',
                '英语': 'course-colors english',
                '英语口语': 'course-colors english',
                '英语听力': 'course-colors english',
                '物理': 'course-colors physics',
                '化学': 'course-colors chemistry',
                '生物': 'course-colors biology',
                '科学': 'course-colors science',
                '历史': 'course-colors history',
                '地理': 'course-colors geography',
                '道德与法治': 'course-colors moral',
                '思想品德': 'course-colors moral',
                '音乐': 'course-colors music',
                '美术': 'course-colors art',
                '体育': 'course-colors pe',
                '体育与健康': 'course-colors pe',
                '信息技术': 'course-colors computer',
                '劳动技术': 'course-colors labor',
                '通用技术': 'course-colors labor',
                '综合实践': 'course-colors labor',
                '心理健康': 'course-colors mental',
                '班会': 'course-colors',
                '自习': 'course-colors',
                '课外活动': 'course-colors'
            };
            return colorMap[courseName] || 'course-item';
        }

        // 删除学生
        function deleteStudent(studentId) {
            if (confirm('确定要删除该学生吗？此操作不可恢复！')) {
                students = students.filter(s => s.id !== studentId);
                saveData();
                updateStats();
                updateFilters();
                renderStudents();
                renderExcelTable(); // 自动更新Excel表格
                alert('学生删除成功！');
            }
        }

        // 渲染学生列表
        function renderStudents() {
            const container = document.getElementById('studentGrid');
            container.innerHTML = '';

            const filteredStudents = getFilteredStudents();

            filteredStudents.forEach(student => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-id">ID: ${student.id}</div>
                    </div>
                    <div class="student-info">
                        <div class="info-item">
                            <div class="info-label">年龄</div>
                            <div class="info-value">${student.age || '未填写'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">年级班级</div>
                            <div class="info-value">${student.grade} ${student.class}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">联系电话</div>
                            <div class="info-value">${student.phone || '未填写'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">宿舍楼</div>
                            <div class="info-value">${student.dorm || '未填写'}</div>
                        </div>
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <div class="info-label">家庭住址</div>
                            <div class="info-value">${student.address || '未填写'}</div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="showEditStudentModal(${student.id})">编辑</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">删除</button>
                    </div>
                `;
                container.appendChild(card);
            });

            if (filteredStudents.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 50px;">暂无学生信息</div>';
            }
        }

        // 获取过滤后的学生列表
        function getFilteredStudents() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const gradeFilter = document.getElementById('gradeFilter').value;
            const classFilter = document.getElementById('classFilter').value;

            return students.filter(student => {
                const matchSearch = !search ||
                    student.name.toLowerCase().includes(search) ||
                    (student.class && student.class.toLowerCase().includes(search)) ||
                    (student.dorm && student.dorm.toLowerCase().includes(search));

                const matchGrade = !gradeFilter || student.grade === gradeFilter;
                const matchClass = !classFilter || student.class === classFilter;

                return matchSearch && matchGrade && matchClass;
            });
        }

        // 筛选学生
        function filterStudents() {
            renderStudents();
        }

        // 更新统计信息
        function updateStats() {
            document.getElementById('totalStudents').textContent = students.length;

            const grades = [...new Set(students.map(s => s.grade).filter(g => g))];
            document.getElementById('gradeCount').textContent = grades.length;

            const classes = [...new Set(students.map(s => `${s.grade}-${s.class}`).filter(c => c !== '-'))];
            document.getElementById('classCount').textContent = classes.length;

            const dorms = [...new Set(students.map(s => s.dorm).filter(d => d))];
            document.getElementById('dormCount').textContent = dorms.length;
        }

        // 生成班级选项
        function generateClassOptions(gradeValue) {
            const classes = [];
            for (let i = 1; i <= 9; i++) {
                classes.push(`${i}班`);
            }
            return classes;
        }

        // 设置学生表单的年级班级联动
        function setupStudentGradeClassLink() {
            const gradeSelect = document.getElementById('studentGrade');
            const classSelect = document.getElementById('studentClass');

            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">选择班级</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // 更新筛选器
        function updateFilters() {
            const gradeSelect = document.getElementById('gradeFilter');
            const classSelect = document.getElementById('classFilter');

            // 更新年级筛选器
            const currentGrade = gradeSelect.value;
            gradeSelect.innerHTML = '<option value="">所有年级</option>';

            const grades = [...new Set(students.map(s => s.grade).filter(g => g))];
            grades.forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                if (grade === currentGrade) option.selected = true;
                gradeSelect.appendChild(option);
            });

            // 更新班级筛选器
            const currentClass = classSelect.value;
            classSelect.innerHTML = '<option value="">所有班级</option>';

            const classes = [...new Set(students.map(s => s.class).filter(c => c))];
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                if (cls === currentClass) option.selected = true;
                classSelect.appendChild(option);
            });
        }

        // 更新课程表筛选器
        function updateScheduleFilters() {
            const gradeSelect = document.getElementById('scheduleGrade');
            const classSelect = document.getElementById('scheduleClass');

            // 更新年级筛选器
            gradeSelect.innerHTML = '<option value="">选择年级</option>';
            ['初一', '初二', '初三'].forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                gradeSelect.appendChild(option);
            });

            // 更新班级筛选器
            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">选择班级</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // 设置课程表单的年级班级联动
        function setupCourseGradeClassLink() {
            const gradeSelect = document.getElementById('courseGrade');
            const classSelect = document.getElementById('courseClass');

            gradeSelect.onchange = function() {
                const selectedGrade = this.value;
                classSelect.innerHTML = '<option value="">选择班级</option>';

                if (selectedGrade) {
                    const classes = generateClassOptions(selectedGrade);
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                }
            };
        }

        // 生成课程表模板
        function generateScheduleTemplate() {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';

            timeSlots.forEach((time, index) => {
                const row = document.createElement('tr');

                // 时间列
                const timeCell = document.createElement('td');
                timeCell.className = 'time-slot';
                timeCell.textContent = `第${index + 1}节\n${time}`;
                row.appendChild(timeCell);

                // 周一到周日
                for (let day = 1; day <= 7; day++) {
                    const cell = document.createElement('td');
                    cell.className = 'course-cell';
                    cell.setAttribute('data-day', day);
                    cell.setAttribute('data-period', index + 1);
                    cell.onclick = () => editCourseCell(day, index + 1);
                    row.appendChild(cell);
                }

                tbody.appendChild(row);
            });
        }

        // 加载课程表
        function loadSchedule() {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                generateScheduleTemplate();
                return;
            }

            generateScheduleTemplate();

            // 填入课程
            courses.forEach(course => {
                if (course.grade === grade && course.class === cls) {
                    const cell = document.querySelector(`[data-day="${course.day}"][data-period="${course.period}"]`);
                    if (cell) {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = `course-item ${getCourseColorClass(course.name)}`;
                        courseDiv.innerHTML = `${course.name}<br><small>${course.teacher || ''}</small>`;
                        courseDiv.title = `${course.name}${course.teacher ? ' - ' + course.teacher : ''}`;
                        courseDiv.onclick = (e) => {
                            e.stopPropagation();
                            if (confirm(`删除课程：${course.name}？`)) {
                                courses = courses.filter(c => c.id !== course.id);
                                saveData();
                                loadSchedule();
                            }
                        };
                        cell.appendChild(courseDiv);
                    }
                }
            });
        }

        // 编辑课程单元格
        function editCourseCell(day, period) {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                alert('请先选择年级和班级');
                return;
            }

            // 预填表单
            document.getElementById('courseGrade').value = grade;
            document.getElementById('courseClass').value = cls;
            document.getElementById('courseDay').value = day;
            document.getElementById('coursePeriod').value = period;

            showAddCourseModal();
        }

        // 选择今天
        function selectToday() {
            const today = new Date();
            document.getElementById('selectedDate').value = today.toISOString().split('T')[0];
            updateSelectedDateView();
        }

        // 选择明天
        function selectTomorrow() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('selectedDate').value = tomorrow.toISOString().split('T')[0];
            updateSelectedDateView();
        }

        // 选择本周
        function selectThisWeek() {
            selectToday(); // 默认选择今天，用户可以通过日期选择器调整
        }

        // 更新选定日期的课程视图
        function updateSelectedDateView() {
            const selectedDateInput = document.getElementById('selectedDate');
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!selectedDateInput.value || !grade || !cls) {
                return;
            }

            const selectedDate = new Date(selectedDateInput.value);
            const dayOfWeek = selectedDate.getDay(); // 0=Sunday, 1=Monday, ..., 6=Saturday

            // 更新日期显示
            const currentDate = selectedDate.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            document.getElementById('currentDate').textContent = currentDate;
            document.getElementById('selectedClassInfo').textContent = `${grade} ${cls}`;

            // 获取选定日期的课程
            const selectedDateCourses = getTodayCourses(grade, cls, dayOfWeek);
            renderDailyCourses(selectedDateCourses);
        }

        // 显示今日课程查看
        function showDailyView() {
            const grade = document.getElementById('scheduleGrade').value;
            const cls = document.getElementById('scheduleClass').value;

            if (!grade || !cls) {
                alert('请先选择年级和班级');
                return;
            }

            // 设置默认为今天
            selectToday();

            showModal('dailyViewModal');
        }

        // 获取今日课程
        function getTodayCourses(grade, cls, dayOfWeek) {
            // 将JavaScript的星期转换为我们系统的格式
            // JavaScript: 0=Sunday, 1=Monday, ..., 6=Saturday
            // 我们的系统: 1=Monday, ..., 7=Sunday
            let systemDay = dayOfWeek === 0 ? 7 : dayOfWeek;

            return courses.filter(course =>
                course.grade === grade &&
                course.class === cls &&
                parseInt(course.day) === systemDay
            ).sort((a, b) => parseInt(a.period) - parseInt(b.period));
        }

        // 渲染今日课程
        function renderDailyCourses(todayCourses) {
            const container = document.getElementById('dailyCourses');
            container.innerHTML = '';

            if (todayCourses.length === 0) {
                container.innerHTML = `
                    <div class="no-courses">
                        <span class="no-courses-icon">📚</span>
                        <div>今日暂无课程安排</div>
                    </div>
                `;
                return;
            }

            todayCourses.forEach(course => {
                const courseItem = document.createElement('div');
                courseItem.className = 'daily-course-item';

                const timeSlot = timeSlots[parseInt(course.period) - 1] || '时间待定';

                courseItem.innerHTML = `
                    <div class="course-time">
                        第${course.period}节<br>
                        <small>${timeSlot}</small>
                    </div>
                    <div class="course-details">
                        <div class="course-name">${course.name}</div>
                        ${course.teacher ? `<div class="course-teacher">任课教师: ${course.teacher}</div>` : ''}
                    </div>
                `;

                // 添加课程颜色样式
                const colorClass = getCourseColorClass(course.name);
                if (colorClass !== 'course-item') {
                    courseItem.style.borderLeftColor = getComputedStyle(document.createElement('div')).getPropertyValue('background-color') || '#3498DB';
                }

                container.appendChild(courseItem);
            });
        }

        // 保存数据到本地存储
        function saveData() {
            localStorage.setItem('school_students', JSON.stringify(students));
            localStorage.setItem('school_courses', JSON.stringify(courses));
        }

        // 从本地存储加载数据
        function loadData() {
            const savedStudents = localStorage.getItem('school_students');
            const savedCourses = localStorage.getItem('school_courses');

            if (savedStudents) {
                students = JSON.parse(savedStudents);
            }

            if (savedCourses) {
                courses = JSON.parse(savedCourses);
            }
        }

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        };
    </script>
</body>
</html>